## 18.compose

* Compose 通过一个配置文件来管理多个 Docker 容器，在配置文件中，所有的容器通过 services 来定义，然后使用 docker-compose 脚本来启动，停止和重启应用，和应用中的服务以及所有依赖服务的容器，非常适合组合使用多个容器镜像开发的场景 步骤：
* 在`docker-compose.yml`中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行。
* 最后，运行`docker-compose up`，Compose 将启动并运行整个应用程序。配置文件组成
* server 可以定义需要的服务，每个服务都有自己的名字、使用的镜像、挂载的数据所属的网络和依赖的其他服务。
* networks 是应用的网络，在它下面可以定义使用的网络名称，类型。
* volumes 是数据卷，可以在此定义数据卷，然后挂载到不同的服务上面使用。

```
pip install docker-compose
```

### 18.1 docker-compose.yml

* 格式缩进表示层次
* 冒号空格后面有空格

```
version:'2'
services:
    zfpx1;
        image:nginx
        port:
           -:"808:80"
    zfpx2:
        image:nginx
        port:
           -:"8081:80"
```

### 18.2 nginx 工具包

```
apt update
#ping
apt install inetutils-ping
#nslookup
apt install dnsutils
#ifconfig
apt install net-tools
#ip
apt install iproute2
#curl
apt install curl
```

### 18.3 启动

```
docker-compose up 启动所有的服务
docker-compose -d 后台启动所有的服务
docker-compose ps 打印所有的容器
docker-compose stop 停止所有服务
docker-compose logs -f 持续跟踪日志
docker-compose exec zfpx1 bash 进入zfpx服务系统
docker-compose rm 删除服务容器
docker-compose ls 网络不会删除
docker-compose down 删除网络
```

* docker 会创建默认的网络

### 18.4 配置网络

```
docker-compose up -d
docker-compose exec zfpx1 bash
ping zfpx2 可以通过服务的名字连接对方
```

### 18.5 配置数据卷

```
version:'2'
services:
    zfpx1:
        image:nginx
        ports:
            -:"8080:80"
        newworks:
            -:"zfpx"
        volumes:
            -:"access:/mnt"
    zfpx2：
        image:nginx
        ports:
            -:"8081:80"
        networks:
            -:"zfpx"
        volumes:
            -:"access:/mnt"
    zfpx3:
        image:nginx
        ports:
            -:'8082:80'
        networks:
            -:"default"
            -:"zfpx"
    networks:
        zfpx:
            driver:bridge
    volumes:
        access;
            driver:local
```

### 18.6 配置根目录

```
version:'2'
services:
    zfpx1:
        image:nginx
        ports:
            -:"8080:80"
        newworks:
            -:"zfpx"
        volumes:
            -:"access:/mnt"
            -:"./zfpx1:/usr/share/nginx/html"
    zfpx2：
        image:nginx
        ports:
            -:"8081:80"
        networks:
            -:"zfpx"
        volumes:
            -:"access:/mnt"
            -:"./zfpx2:/usr/share/nginx/html"
    zfpx3:
        image:nginx
        ports:
            -:'8082:80'
        networks:
            -:"default"
            -:"zfpx"
    networks:
        zfpx:
            driver:bridge
    volumes:
        access;
            driver:local
```
